#### 1. Текущие проблемы
1. **Сайт медленно загружает страницы** - по условию задачи, когда повышается нагрузка на приложение, то пользователи жалуются на медленную загрузку страниц. При этом, даны RPS:
   1. максимально зафиксированная нагрузка на запросы поиска - 50 RPS;
   2. максимально зафиксированная нагрузка на запросы оформления — 10 RPS;
   3. в задании не указано ничего про мониторинг в системе, но даны цифры RPS на чтение и на запись;
2. **Нарушается SLA для B2B-клиентов** - партнеры жалуются, что наше *API* не соответствует заявленному *SLA*;
   1. в соответствии с заданием - некоторые из B2B-партнеров могут не соблюдать ранее оговоренную нагрузку (max RPS). В частности, есть случай, когда один из партнеров нагружает систему на 250RPS при договоренности на 20RPS;
3. **Приложение падает** - InsureTech несколько раз столкнулась с проблемой недоступности приложения:
   1. написано, что команда реагировала на проблему медленно, так как узнавала о проблеме от пользователей. Это свидетельсвует о проблемах с *observability* - нужно повышать наблдаемость системы; 

#### 2. Требования к доступности системы
- согласованое время обслуживания: 24/7: 24ч * 7дн * 52нед = 8736ч
- RTO (Recovery Time Objective): 45 мин
- RPO (Recovery Point Objective): 15 мин
- доступность: 99,9%

#### 3. Требования к производительности
- Время загрузки страниц на стороне пользователя - одинаково для пользователей из разных регионов. Время загрузки страницы не должно зависеть от географического местоположения пользователя.;

#### 4. Принципиальные решения

#### 4.1. Стратегия отказоустойчивости
- Выбранная стратегия - *Active-Active*;
- Обоснование: 
1. рассматривались варианты: *Active-Active* и *Active-StandBy*;
2. стратегия *Active-StandBy* рекомендуется к применению в случаях, когда требуемая доступность системы не более 99,5%;
3. в нашем случае, требуемая доступность 99,9%, поэтому выбираем *Active-Active*;
- Реализация:
1. используем два независимых k8s-кластера;
2. кластеры будут располагаться в разных *data*-центрах. Выбранные *data*-центры располагаются в разных регионах РФ;
3. маршрутизация пользователей осуществляется с помощью *GSLB (Global Server Load Balancer)*;
4. реализация должна обеспечивать отказоустойчивость в случае отказа одного из *data*-центров:
   1. количество инстансов приложений одного *k8s*-кластера (*k8s*-кластера в одной **зоне доступности**) должно выдерживать нагрузку;
   2. количество реплик БД в одной **зоне доступности** должно выдерживать полную предполагаемую нагрузку;

#### 4.2. Стратегия масштабирования
- в качестве стратегии масштабирования используем *HPA + cluster autoscaling*;
- это позволит масштабировать количество нод внутри кластеров;
- так как предполагается развертывания двух кластеров в разных *data*-центрах, то стратегия *HPA + cluster autoscaling* будет применяться для каждого кластера отдельно;

#### 4.3. Стратегия конфигурации БД
- используем шардирование данных по регионам - это позволит уменьшить (выровнять) время загрузки страниц на стороне пользователя в разных регионах:
  - ключ шардирования - регион (directory-based sharding);
- используем репликацию. Количество реплик на **один k8s-кластер**:
  - используем multi-master репликацию;
  - два ключа шардирования:
    - key1-msk, key2-nsk;
    - на каждый ключ шардирования 3 реплики;
    - пример:
      - msk-cluster: msk-write, 2*msk-read; nsk-write, 2*nsk-read;
      - nsk-cluster2: msk-write, 2*msk-read; nsk-write, 2*nsk-read;
- резервное копирование:
  - в соответствии с требованиями: *RPO (Recovery Point Objective)* = 15мин;
  - соответственно, необходимо постоянно делать бекапы:
    - https://www.techtarget.com/searchstorage/definition/continuous-data-protection

#### 4.3. Стратегия геораспределения
1. используем два независимых k8s-кластера в разных *data*-центрах;
2. используем *CDN* - для быстрой доставки статического контента в разных регионах;
остановился здесь

#### 4.4. повышение *observability* (наблюдаемости, мониторинга)
1. повышаем *observability* системы - так как о проблемах нашей системы сообщают пользователи (пользователи frontend и API), это означает, что мы получаем недостаточно информации о нашей системе. Необходимо получать информацию из:
   1. мониторинга - сбор бизнесовых и инфраструктурных метрик;
   2. логирования - сбор логов;
   3. трейсинг - сбор трейсов внутренних вызовов;

